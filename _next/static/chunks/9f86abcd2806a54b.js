(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18333,e=>{"use strict";var t=e.i(71645);function a(e,r=5e3){(0,t.useEffect)(()=>{let t=setInterval(()=>{e()},r);return()=>clearInterval(t)},[e,r])}e.s(["useRealtimeUpdates",()=>a])},31886,e=>{"use strict";var t=e.i(43476),a=e.i(73297),r=e.i(71645);function o({imageUrl:e,lots:o,onLotClick:s,isEditMode:l=!1,onAreaDrawn:n,selectedLotId:i,selectedLotIds:d=[],drawingMode:c="polygon",previewArea:u=null}){let{canvasRef:m,imageRef:x,containerRef:g,hoveredLot:h,drawingPoints:p,scale:b,handleCanvasClick:y,handleCanvasMouseMove:f,handleMouseDown:v,handleMouseUp:j,handleContextMenu:N,handleTouchStart:w,handleTouchMove:L,handleTouchEnd:E,handleZoomIn:S,handleZoomOut:R,handleResetZoom:M,handleFinishDrawing:k,handleCancelDrawing:A}=function({imageUrl:e,lots:t,onLotClick:o,isEditMode:s=!1,onAreaDrawn:l,selectedLotId:n,selectedLotIds:i=[],drawingMode:d="polygon",previewArea:c=null}){let u=(0,r.useRef)(null),m=(0,r.useRef)(null),x=(0,r.useRef)(null),[g,h]=(0,r.useState)([]),[p,b]=(0,r.useState)(null),[y,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)(1),[N,w]=(0,r.useState)({x:0,y:0}),[L,E]=(0,r.useState)(!1),[S,R]=(0,r.useState)({x:0,y:0}),[M,k]=(0,r.useState)(null),[A,C]=(0,r.useState)(1),[D,V]=(0,r.useState)({x:0,y:0}),[P,$]=(0,r.useState)(null),[B,I]=(0,r.useState)(!1),[T,z]=(0,r.useState)(null),[O,U]=(0,r.useState)(null),Y=(0,r.useCallback)(()=>{let e=u.current,r=m.current;if(!e||!r||!y)return;let o=e.getContext("2d");if(o){if(o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.clearRect(0,0,e.width,e.height),o.save(),o.translate(N.x,N.y),o.scale(v,v),o.drawImage(r,0,0),t.forEach(e=>{let t=e.id===n||i.includes(e.id);((e,t,r,o)=>{if(t.area.points.length<3)return;e.beginPath(),e.moveTo(t.area.points[0].x,t.area.points[0].y),t.area.points.forEach(t=>{e.lineTo(t.x,t.y)}),e.closePath();let s="rgba(34, 197, 94, 0.3)",l="#22c55e";t.status===a.LotStatus.RESERVED?(s="rgba(251, 191, 36, 0.3)",l="#fbbf24"):t.status===a.LotStatus.SOLD&&(s="rgba(239, 68, 68, 0.3)",l="#ef4444"),r&&(s=s.replace("0.3","0.5"),l="#000"),o&&(s="rgba(59, 130, 246, 0.5)",l="#3b82f6"),e.fillStyle=s,e.fill(),e.strokeStyle=l,e.lineWidth=r||o?3:2,e.stroke()})(o,e,e.id===p?.id,t)}),s&&"polygon"===d&&g.length>0&&(o.beginPath(),o.moveTo(g[0].x,g[0].y),g.forEach(e=>{o.lineTo(e.x,e.y)}),o.strokeStyle="#3b82f6",o.lineWidth=2/v,o.stroke(),g.forEach(e=>{o.beginPath(),o.arc(e.x,e.y,5/v,0,2*Math.PI),o.fillStyle="#3b82f6",o.fill()})),s&&"rectangle"===d&&B&&T&&O){let e=O.x-T.x,t=O.y-T.y;o.strokeStyle="#3b82f6",o.fillStyle="rgba(59, 130, 246, 0.2)",o.lineWidth=2/v,o.strokeRect(T.x,T.y,e,t),o.fillRect(T.x,T.y,e,t)}s&&c&&c.points.length>=3&&(o.beginPath(),o.moveTo(c.points[0].x,c.points[0].y),c.points.forEach(e=>{o.lineTo(e.x,e.y)}),o.closePath(),o.fillStyle="rgba(34, 197, 94, 0.3)",o.fill(),o.strokeStyle="#22c55e",o.lineWidth=3/v,o.stroke(),c.points.forEach(e=>{o.beginPath(),o.arc(e.x,e.y,6/v,0,2*Math.PI),o.fillStyle="#22c55e",o.fill(),o.strokeStyle="#fff",o.lineWidth=2/v,o.stroke()})),o.restore()}},[y,t,g,p,n,i,s,v,N,d,B,T,O,c]);(0,r.useEffect)(()=>{let t=u.current,a=m.current;if(!t||!a||!e||""===e.trim())return;let r=()=>{t.width=a.naturalWidth,t.height=a.naturalHeight,f(!0)},o=()=>{console.error("Erro ao carregar imagem do mapa")};return a.addEventListener("load",r),a.addEventListener("error",o),a.src=e,()=>{a.removeEventListener("load",r),a.removeEventListener("error",o)}},[e]),(0,r.useEffect)(()=>{Y()},[Y]);let X=(e,t,a)=>{let r=!1;for(let o=0,s=a.length-1;o<a.length;s=o++){let l=a[o].x,n=a[o].y,i=a[s].x,d=a[s].y;n>t!=d>t&&e<(i-l)*(t-n)/(d-n)+l&&(r=!r)}return r},W=e=>{let t=u.current;if(!t)return{x:0,y:0};let a=t.getBoundingClientRect(),r=e.clientX-a.left,o=e.clientY-a.top,s=t.width/a.width,l=t.height/a.height;return{x:(r*s-N.x)/v,y:(o*l-N.y)/v}},q=(0,r.useCallback)(e=>{e.preventDefault();let t=u.current;if(!t)return;let a=t.getBoundingClientRect(),r=e.clientX-a.left,o=e.clientY-a.top,s=t.width/a.width,l=t.height/a.height,n=r*s,i=o*l,d=(n-N.x)/v,c=(i-N.y)/v,m=Math.max(.5,Math.min(v+(e.deltaY>0?-.1:.1),5));j(m),w({x:n-d*m,y:i-c*m})},[v,N]),F=(e,t)=>{let a=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(a*a+r*r)},Z=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2});return(0,r.useEffect)(()=>{let e=u.current;if(e)return e.addEventListener("wheel",q,{passive:!1}),()=>{e.removeEventListener("wheel",q)}},[q]),{canvasRef:u,imageRef:m,containerRef:x,hoveredLot:p,drawingPoints:g,scale:v,handleCanvasClick:e=>{if(L||B)return;let{x:a,y:r}=W(e);if(s&&"polygon"===d)h([...g,{x:a,y:r}]);else if(!s){let e=t.find(e=>X(a,r,e.area.points));e&&o&&o(e)}},handleCanvasMouseMove:e=>{let a=u.current;if(!a)return;if(L){let t=a.getBoundingClientRect(),r=a.width/t.width,o=a.height/t.height,s=(e.clientX-S.x)*r,l=(e.clientY-S.y)*o;w(e=>({x:e.x+s,y:e.y+l})),R({x:e.clientX,y:e.clientY});return}if(B&&T){let{x:t,y:a}=W(e);U({x:t,y:a});return}if(s)return;let{x:r,y:o}=W(e),l=t.find(e=>X(r,o,e.area.points));b(l||null),l?a.style.cursor="pointer":a.style.cursor="default"},handleMouseDown:e=>{if(2===e.button)e.preventDefault(),E(!0),R({x:e.clientX,y:e.clientY}),u.current&&(u.current.style.cursor="grabbing");else if(0===e.button&&s&&"rectangle"===d){let{x:t,y:a}=W(e);I(!0),z({x:t,y:a}),U({x:t,y:a})}},handleMouseUp:e=>{if(E(!1),u.current&&(u.current.style.cursor="default"),B&&T&&l){let t=W(e),a=Math.min(T.x,t.x),r=Math.max(T.x,t.x),o=Math.min(T.y,t.y),s=Math.max(T.y,t.y),n=s-o;if(r-a>10&&n>10){let e=[{x:a,y:o},{x:r,y:o},{x:r,y:s},{x:a,y:s}];console.log("üìê Ret√¢ngulo criado:",{start:T,end:t,points:e}),l({points:e})}I(!1),z(null),U(null)}},handleContextMenu:e=>{e.preventDefault()},handleTouchStart:e=>{if(2===e.touches.length){let t=F(e.touches[0],e.touches[1]),a=Z(e.touches[0],e.touches[1]),r=u.current;if(!r)return;let o=r.getBoundingClientRect(),s=a.x-o.left,l=a.y-o.top;k(t),C(v),V({x:N.x,y:N.y}),$({x:s,y:l})}else 1!==e.touches.length||s||(E(!0),R({x:e.touches[0].clientX-N.x,y:e.touches[0].clientY-N.y}))},handleTouchMove:e=>{if(2===e.touches.length&&null!==M&&P){e.preventDefault();let t=u.current;if(!t)return;let a=t.getBoundingClientRect(),r=Z(e.touches[0],e.touches[1]),o=r.x-a.left,s=r.y-a.top,l=Math.max(.5,Math.min(F(e.touches[0],e.touches[1])/M*A,5)),n=t.width/a.width,i=t.height/a.height,d=P.x*n,c=P.y*i,m=(d-D.x)/A,x=(c-D.y)/A;j(l),w({x:o*n-m*l,y:s*i-x*l})}else 1===e.touches.length&&L&&!s&&(e.preventDefault(),w({x:e.touches[0].clientX-S.x,y:e.touches[0].clientY-S.y}))},handleTouchEnd:()=>{k(null),$(null),E(!1)},handleZoomIn:()=>{j(e=>Math.min(e+.2,5))},handleZoomOut:()=>{j(e=>Math.max(e-.2,.5))},handleResetZoom:()=>{j(1),w({x:0,y:0})},handleFinishDrawing:()=>{"polygon"===d&&g.length>=3&&l&&(l({points:g}),h([]))},handleCancelDrawing:()=>{h([]),I(!1),z(null),U(null)}}}({imageUrl:e,lots:o,onLotClick:s,isEditMode:l,onAreaDrawn:n,selectedLotId:i,selectedLotIds:d,drawingMode:c,previewArea:u});return(0,t.jsxs)("div",{ref:g,className:"relative",children:[e&&""!==e.trim()?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{ref:x,src:e,alt:"Map",className:"hidden"}),(0,t.jsx)("canvas",{ref:m,onClick:y,onMouseMove:f,onMouseDown:v,onMouseUp:j,onMouseLeave:j,onContextMenu:N,onTouchStart:w,onTouchMove:L,onTouchEnd:E,className:"border border-gray-300 rounded-lg shadow-lg cursor-crosshair max-w-full"})]}):(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center bg-gray-50",children:[(0,t.jsx)("svg",{className:"w-24 h-24 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-gray-600 font-medium mb-2",children:"Nenhuma imagem do mapa carregada"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Adicione uma imagem ao mapa para come√ßar a desenhar os lotes"})]}),(0,t.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:[(0,t.jsx)("button",{onClick:S,className:"bg-white hover:bg-gray-50 text-gray-800 font-bold py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl cursor-pointer",title:"Zoom In",children:"+"}),(0,t.jsx)("button",{onClick:R,className:"bg-white hover:bg-gray-50 text-gray-800 font-bold py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl cursor-pointer",title:"Zoom Out",children:"-"}),(0,t.jsx)("button",{onClick:M,className:"bg-white hover:bg-gray-50 text-gray-800 font-medium py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl text-xs cursor-pointer",title:"Reset Zoom",children:"Reset"}),(0,t.jsxs)("div",{className:"bg-white px-3 py-1 rounded-lg shadow-lg border border-gray-200 text-xs text-gray-700 text-center",children:[Math.round(100*b),"%"]})]}),l&&"polygon"===c&&p.length>0&&(0,t.jsxs)("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[(0,t.jsxs)("button",{onClick:k,className:"px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 shadow-lg transition-all hover:shadow-xl disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none cursor-pointer",disabled:p.length<3,children:["Finalizar √Årea (",p.length," pontos)"]}),(0,t.jsx)("button",{onClick:A,className:"px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 shadow-lg transition-all hover:shadow-xl cursor-pointer",children:"Cancelar"})]}),l&&"rectangle"===c&&!u&&(0,t.jsx)("div",{className:"absolute bottom-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg",children:(0,t.jsx)("p",{className:"font-medium",children:"üî≤ Modo Ret√¢ngulo: Clique e arraste para desenhar"})}),l&&u&&u.points.length>=3&&(0,t.jsx)("div",{className:"absolute bottom-4 left-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg",children:(0,t.jsx)("p",{className:"font-medium",children:"‚úÖ √Årea selecionada - Complete as informa√ß√µes do lote"})}),h&&!l&&(0,t.jsxs)("div",{className:"absolute top-4 left-4 bg-white p-4 rounded-lg shadow-xl border border-gray-200",children:[(0,t.jsxs)("h3",{className:"font-bold text-lg text-gray-900 mb-2",children:["Lote ",h.lotNumber]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Status:"})," ",(0,t.jsx)("span",{className:h.status===a.LotStatus.AVAILABLE?"font-semibold text-green-700":h.status===a.LotStatus.RESERVED?"font-semibold text-amber-700":"font-semibold text-red-700",children:h.status===a.LotStatus.AVAILABLE?"Dispon√≠vel":h.status===a.LotStatus.RESERVED?"Reservado":"Vendido"})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"√Årea:"})," ",h.size,"m¬≤"]}),(0,t.jsxs)("p",{className:"text-base font-bold text-gray-900 mt-2",children:["R$ ",h.price.toLocaleString("pt-BR")]}),h.pricePerM2&&(0,t.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["R$ ",h.pricePerM2.toLocaleString("pt-BR"),"/m¬≤"]})]})]})}e.s(["default",()=>o],31886)},25863,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),o=e.i(83642),s=e.i(73297);e.i(47167);var l=e.i(81949),n=e.i(31886),i=e.i(18333);let d="http://localhost:5678/webhook-test/loteamento";function c(){let e=(0,r.useSearchParams)(),o=(0,r.useRouter)(),c=e.get("mapId")||"",[u,m]=(0,a.useState)(null),[x,g]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[f,v]=(0,a.useState)(null),[j,N]=(0,a.useState)(),[w,L]=(0,a.useState)(!0),[E,S]=(0,a.useState)("rectangle"),[R,M]=(0,a.useState)(null);(0,a.useEffect)(()=>{h&&M(null)},[h,j]);let k=(0,a.useCallback)(async()=>{if(c)try{console.log(`[LotManagement] üîÑ Carregando dados do mapa ${c}...`);let e=await l.default.get(`${d}/mapas/lotes`,{params:{mapId:c},timeout:1e4});console.log("[LotManagement] ‚úÖ Resposta recebida:",e.data);let t=e.data[0];if(t){let e={id:t.mapId||t.id||c,name:t.name||`Mapa ${t.mapId||c}`,description:t.description||"",imageUrl:t.imageUrl||"",imageType:"image",width:t.width||800,height:t.height||600,createdAt:t.createdAt?new Date(t.createdAt):new Date,updatedAt:t.updatedAt?new Date(t.updatedAt):new Date};if(m(e),t.lots&&Array.isArray(t.lots)){let e=t.lots.map(e=>{let a=e.area;if(e.area&&"string"==typeof e.area.points)try{a={...e.area,points:JSON.parse(e.area.points)},console.log("[LotManagement] üîß Area.points parseado:",a.points)}catch(e){console.error("[LotManagement] ‚ùå Erro ao parsear area.points:",e)}return{...e,area:a,mapId:t.mapId||c,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}});console.log("[LotManagement] üìç Lotes carregados:",e.map(e=>({id:e.id,lotNumber:e.lotNumber,pointsCount:e.area?.points?.length||0,firstPoint:e.area?.points?.[0],lastPoint:e.area?.points?.[e.area?.points?.length-1]}))),g(e)}else g([])}}catch(e){console.error("[LotManagement] ‚ùå Erro ao buscar dados:",e),m({id:c,name:`Mapa ${c}`,description:"",imageUrl:"",imageType:"image",width:800,height:600,createdAt:new Date,updatedAt:new Date}),g([]),alert("Erro ao carregar dados do mapa. Usando valores padr√£o.")}finally{L(!1)}},[c]);(0,a.useEffect)(()=>{k()},[k]),(0,i.useRealtimeUpdates)(()=>{h||b||k()},3e3);let A=async()=>{try{console.log("[LotManagement] üîÑ Recarregando lotes...");let e=await l.default.get(`${d}/mapas/lotes`,{params:{mapId:c},timeout:1e4});console.log("[LotManagement] ‚úÖ Lotes recarregados:",e.data);let t=e.data[0];if(t)if(t.lots&&Array.isArray(t.lots)){let e=t.lots.map(e=>{let a=e.area;if(e.area&&"string"==typeof e.area.points)try{a={...e.area,points:JSON.parse(e.area.points)}}catch(e){console.error("[LotManagement] ‚ùå Erro ao parsear area.points no reload:",e)}return{...e,area:a,mapId:t.mapId||c,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}});g(e)}else g([])}catch(e){console.error("Erro ao recarregar lotes:",e)}},C=async e=>{try{console.log("[LotManagement] üì§ Salvando lote:",e),await l.default.post(`${d}/mapas/lotes/criar`,e,{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[LotManagement] ‚úÖ Lote salvo com sucesso"),await A()}catch(e){throw console.error("[LotManagement] ‚ùå Erro ao salvar lote:",e),e}},D=async e=>{try{console.log("[LotManagement] üìù Atualizando lote:",e),await l.default.patch(`${d}/mapas/lotes`,e,{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[LotManagement] ‚úÖ Lote atualizado com sucesso"),await A()}catch(e){throw console.error("[LotManagement] ‚ùå Erro ao atualizar lote:",e),e}},V=async e=>{try{console.log(`[LotManagement] üóëÔ∏è Deletando lote ${e}...`),await l.default.delete(`${d}/mapas/lotes/deletar`,{params:{lotId:e},timeout:1e4}),console.log("[LotManagement] ‚úÖ Lote deletado com sucesso"),await A()}catch(e){throw console.error("[LotManagement] ‚ùå Erro ao deletar lote:",e),e}},P=e=>{e!==E&&(b&&y({...b,area:{points:[]}}),M(null),S(e))},$=async e=>{try{console.log(`üîç Validando n\xfamero do lote ${e} para o mapa ${c}...`);let t=await l.default.get(`${d}/mapas/lotes/numero-valido`,{params:{mapId:c,lotNumber:e}}),a=0===t.data.lotExists;return console.log(`‚úÖ Resultado da valida\xe7\xe3o (lotExists: ${t.data.lotExists}):`,a?"N√∫mero dispon√≠vel":"N√∫mero j√° existe"),a}catch(e){return console.error("‚ùå Erro ao validar n√∫mero do lote:",e),alert("Erro ao validar o n√∫mero do lote. Tente novamente."),!1}},B=async()=>{if(!b)return void alert("Nenhum lote em edi√ß√£o");if(!b.lotNumber||""===b.lotNumber.trim())return void alert("‚ùå N√∫mero do lote √© obrigat√≥rio");let e=x.find(e=>e.id===b.id);if((!e||e.lotNumber!==b.lotNumber)&&!await $(b.lotNumber))return void alert(`‚ùå O n\xfamero do lote "${b.lotNumber}" j\xe1 est\xe1 em uso. Escolha outro n\xfamero.`);if(!b.area||!b.area.points||b.area.points.length<3)return void alert("‚ùå √Årea do lote n√£o foi desenhada!\n\nVoc√™ precisa desenhar a √°rea do lote no mapa antes de salvar.\n\nClique no mapa para definir pelo menos 3 pontos da √°rea do lote.");if(!b.size||b.size<=0)return void alert("‚ùå Informe o tamanho do lote (m¬≤)");if(!b.pricePerM2||b.pricePerM2<=0)return void alert("‚ùå Informe o pre√ßo por m¬≤ do lote");if(!b.price||b.price<=0)return void alert("‚ùå O pre√ßo total do lote deve ser maior que zero");let t={...b,mapId:c,updatedAt:new Date};console.log("üíæ Salvando lote:",{id:t.id,lotNumber:t.lotNumber,pointsCount:t.area.points.length,points:t.area.points,firstPoint:t.area.points[0],lastPoint:t.area.points[t.area.points.length-1]});try{t.id&&""!==t.id?await D(t):await C(t),p(!1),y(null),N(void 0),M(null)}catch(e){console.error("Erro ao salvar:",e),alert("Erro ao salvar lote. Tente novamente.")}},I=async e=>{let t=x.find(t=>t.id===e);if(t&&(t.status===s.LotStatus.RESERVED||t.status===s.LotStatus.SOLD)){let e=t.status===s.LotStatus.RESERVED?"reservado":"vendido";alert(`‚ùå N\xe3o \xe9 poss\xedvel excluir este lote!

O Lote ${t.lotNumber} est\xe1 ${e}.

Para excluir este lote, voc\xea precisa primeiro cancelar a ${t.status===s.LotStatus.RESERVED?"reserva":"venda"} na p\xe1gina de Reservas.`);return}if(confirm("Tem certeza que deseja excluir este lote?"))try{await V(e)}catch(e){console.error("Erro ao deletar:",e),alert("Erro ao deletar lote. Tente novamente.")}},T=e=>{e.status!==s.LotStatus.AVAILABLE?v(e):(y(e),p(!0),N(e.id),M(null))};return w||!u?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("p",{className:"text-gray-600",children:"Carregando..."})}):(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("button",{onClick:()=>o.push("/admin/maps"),className:"text-blue-700 hover:text-blue-900 font-medium hover:underline mb-2 transition-colors cursor-pointer",children:"‚Üê Voltar para Mapas"}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:u.name}),u.description&&(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:u.description})]}),(0,t.jsxs)("div",{className:"flex gap-3 items-center",children:[h&&(0,t.jsxs)("div",{className:"flex gap-2 border border-gray-300 rounded-lg p-1 bg-gray-50",children:[(0,t.jsx)("button",{onClick:()=>P("rectangle"),className:`px-3 py-1.5 rounded font-medium text-sm transition-all cursor-pointer ${"rectangle"===E?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100"}`,title:"Desenhar ret√¢ngulo (clicar e arrastar)",children:"üî≤ Ret√¢ngulo"}),(0,t.jsx)("button",{onClick:()=>P("polygon"),className:`px-3 py-1.5 rounded font-medium text-sm transition-all cursor-pointer ${"polygon"===E?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100"}`,title:"Desenhar pol√≠gono (clicar ponto a ponto)",children:"üìê Pol√≠gono"})]}),!h&&(0,t.jsx)("button",{onClick:()=>{y({id:"",mapId:c,lotNumber:"",area:{points:[]},status:s.LotStatus.AVAILABLE,price:0,size:0,pricePerM2:0,description:"",features:[],createdAt:new Date,updatedAt:new Date}),p(!0),N(void 0),M(null)},className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 shadow-md transition-all hover:shadow-lg cursor-pointer",children:"Novo Lote"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(n.default,{imageUrl:u.imageUrl,lots:x,isEditMode:h,onAreaDrawn:e=>{b&&(console.log(`üìê \xc1rea desenhada recebida (modo: ${E}):`,{mode:E,pointsCount:e.points.length,points:e.points,firstPoint:e.points[0],lastPoint:e.points[e.points.length-1]}),y({...b,area:e}),M(e))},selectedLotId:j,drawingMode:E,previewArea:R,onLotClick:e=>{h||T(e)}})}),(0,t.jsxs)("div",{className:"space-y-4",children:[h&&b&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:[b.area.points.length>0?"Editar":"Novo"," Lote"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"N√∫mero do Lote"}),(0,t.jsx)("input",{type:"text",value:b.lotNumber,onChange:e=>y({...b,lotNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: 01, A1, etc"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Status"}),(0,t.jsx)("select",{value:b.status,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 bg-gray-100 cursor-not-allowed",children:(0,t.jsx)("option",{value:s.LotStatus.AVAILABLE,children:"Dispon√≠vel"})}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Status √© controlado automaticamente pelas reservas"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"√Årea (m¬≤)"}),(0,t.jsx)("input",{type:"number",value:b.size||"",onChange:e=>{let t=""===e.target.value?0:parseFloat(e.target.value),a=b.pricePerM2||0;y({...b,size:t,price:t*a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"300"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Pre√ßo por m¬≤ (R$)"}),(0,t.jsx)("input",{type:"number",value:b.pricePerM2||"",onChange:e=>{let t=""===e.target.value?0:parseFloat(e.target.value),a=b.size||0;y({...b,pricePerM2:t,price:a*t})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"150"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Pre√ßo Total (R$)"}),(0,t.jsx)("input",{type:"number",value:b.price||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 bg-gray-100 cursor-not-allowed focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Calculado automaticamente: ",b.size||0," m¬≤ √ó R$ ",b.pricePerM2||0]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Status"}),(0,t.jsx)("select",{value:b.status,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 bg-gray-100 cursor-not-allowed",children:(0,t.jsx)("option",{value:s.LotStatus.AVAILABLE,children:"Dispon√≠vel"})}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Status √© controlado automaticamente pelas reservas"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Descri√ß√£o"}),(0,t.jsx)("textarea",{value:b.description,onChange:e=>y({...b,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Descri√ß√£o do lote"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Caracter√≠sticas (separadas por v√≠rgula)"}),(0,t.jsx)("input",{type:"text",value:b.features?.join(", ")||"",onChange:e=>y({...b,features:e.target.value.split(",").map(e=>e.trim())}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"√Ågua, Luz, Portaria"})]}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,t.jsx)("p",{className:"text-sm text-blue-800 font-medium",children:0===b.area.points.length?"üëÜ Clique no mapa para desenhar a √°rea do lote":`‚úì ${b.area.points.length} pontos desenhados`})}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:B,className:"flex-1 px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 shadow-sm transition-all hover:shadow-md disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none cursor-pointer",disabled:b.area.points.length<3,children:"Salvar"}),(0,t.jsx)("button",{onClick:()=>{p(!1),y(null),N(void 0),M(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 shadow-sm transition-colors cursor-pointer",children:"Cancelar"})]}),b.id&&(0,t.jsxs)("button",{onClick:async()=>{await I(b.id),p(!1),y(null),N(void 0),M(null)},className:"w-full px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 shadow-sm transition-colors cursor-pointer flex items-center justify-center gap-2",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Excluir Lote"]})]})]})]}),!h&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Lotes Cadastrados"}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[x.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-bold text-gray-900",children:["Lote ",e.lotNumber]}),(0,t.jsx)("p",{className:"text-sm font-medium",children:(0,t.jsx)("span",{className:e.status===s.LotStatus.AVAILABLE?"text-green-700":e.status===s.LotStatus.RESERVED?"text-amber-700":"text-red-700",children:e.status===s.LotStatus.AVAILABLE?"Dispon√≠vel":e.status===s.LotStatus.RESERVED?"Reservado":"Vendido"})})]}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:["R$ ",e.price.toLocaleString("pt-BR")]})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"√Årea:"})," ",e.size,"m¬≤"]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>T(e),className:`flex-1 px-3 py-1 text-white text-sm font-medium rounded transition-colors shadow-sm hover:shadow-md cursor-pointer ${e.status===s.LotStatus.AVAILABLE?"bg-blue-600 hover:bg-blue-700":"bg-gray-600 hover:bg-gray-700"}`,children:e.status===s.LotStatus.AVAILABLE?"Editar":"Ver Detalhes"}),(0,t.jsx)("button",{onClick:()=>I(e.id),className:"px-3 py-1 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition-colors shadow-sm hover:shadow-md cursor-pointer",children:"Excluir"})]})})]},e.id)),0===x.length&&(0,t.jsx)("p",{className:"text-gray-600 text-sm text-center py-4",children:"Nenhum lote cadastrado"})]})]})]})]}),f&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>v(null),children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:`px-6 py-4 rounded-t-2xl ${f.status===s.LotStatus.RESERVED?"bg-gradient-to-r from-amber-500 to-amber-600":"bg-gradient-to-r from-red-500 to-red-600"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-white",children:["Lote ",f.lotNumber]}),(0,t.jsx)("p",{className:"text-white/90 text-sm mt-1",children:f.status===s.LotStatus.RESERVED?"üîí Reservado":"‚úì Vendido"})]}),(0,t.jsx)("button",{onClick:()=>v(null),className:"text-white hover:bg-white/20 rounded-lg p-2 transition-colors",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)("div",{className:`rounded-xl p-4 border-2 ${f.status===s.LotStatus.RESERVED?"bg-amber-50 border-amber-300":"bg-red-50 border-red-300"}`,children:(0,t.jsx)("p",{className:`text-sm font-medium ${f.status===s.LotStatus.RESERVED?"text-amber-800":"text-red-800"}`,children:f.status===s.LotStatus.RESERVED?"‚ö†Ô∏è Este lote est√° reservado e n√£o pode ser editado.":"‚úì Este lote foi vendido e n√£o pode ser editado."})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"N√∫mero do Lote"}),(0,t.jsx)("p",{className:"text-xl font-bold text-gray-900",children:f.lotNumber})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,t.jsx)("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${f.status===s.LotStatus.RESERVED?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"}`,children:f.status===s.LotStatus.RESERVED?"Reservado":"Vendido"})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"√Årea"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:[f.size," m¬≤"]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Pre√ßo Total"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:["R$ ",f.price.toLocaleString("pt-BR")]}),f.pricePerM2&&(0,t.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["R$ ",f.pricePerM2.toLocaleString("pt-BR"),"/m¬≤"]})]})]}),f.description&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Descri√ß√£o"}),(0,t.jsx)("p",{className:"text-gray-900 leading-relaxed",children:f.description})]}),f.features&&f.features.length>0&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-3",children:"Caracter√≠sticas"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:f.features.map((e,a)=>(0,t.jsx)("span",{className:"px-3 py-1.5 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-lg",children:e},a))})]}),f.area.points.length>0&&(0,t.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-blue-800 mb-2",children:"√Årea Desenhada"}),(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["‚úì ",f.area.points.length," pontos definidos no mapa"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Criado em"}),(0,t.jsx)("p",{className:"text-sm text-gray-900",children:new Date(f.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Atualizado em"}),(0,t.jsx)("p",{className:"text-sm text-gray-900",children:new Date(f.updatedAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]}),(0,t.jsx)("div",{className:"bg-gray-50 px-6 py-4 rounded-b-2xl flex justify-end",children:(0,t.jsx)("button",{onClick:()=>v(null),className:"px-6 py-2.5 text-sm font-medium text-white bg-gray-600 rounded-lg hover:bg-gray-700 transition-colors",children:"Fechar"})})]})})]})}function u(){let e=(0,r.useRouter)(),{user:l}=(0,o.useAuth)();return((0,a.useEffect)(()=>{l?.role===s.UserRole.VENDEDOR&&(console.log("[LotManagement] ‚ö†Ô∏è Vendedor n√£o tem permiss√£o - redirecionando"),e.push("/admin/dashboard"))},[l,e]),l?.role===s.UserRole.VENDEDOR)?null:(0,t.jsx)(c,{})}function m(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"p-6 text-center",children:"Carregando..."}),children:(0,t.jsx)(u,{})})}e.s(["default",()=>m],25863)}]);