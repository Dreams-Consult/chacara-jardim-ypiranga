(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,83642,e=>{"use strict";var o=e.i(43476),t=e.i(71645),r=e.i(73297),s=e.i(81949);let l=(0,t.createContext)(void 0);function a({children:e}){let[a,n]=(0,t.useState)(()=>{{let e=localStorage.getItem("currentUser");if(e)try{return JSON.parse(e)}catch(e){console.error("[AuthContext] Erro ao recuperar usuÃ¡rio:",e),localStorage.removeItem("currentUser")}}return null});(0,t.useEffect)(()=>{let e=()=>{let e=localStorage.getItem("currentUser"),o=localStorage.getItem("userData");if(!a||e||o||(console.log("[AuthContext] âš ï¸ SessÃ£o perdida - fazendo logout automÃ¡tico"),n(null)),!a&&(e||o))try{let t=JSON.parse(e||o||"");console.log("[AuthContext] ðŸ”„ Restaurando sessÃ£o do localStorage"),n(t)}catch(e){console.error("[AuthContext] Erro ao restaurar sessÃ£o:",e),localStorage.removeItem("currentUser"),localStorage.removeItem("userData")}};e();let o=setInterval(e,3e4);return()=>clearInterval(o)},[a]);let u=async(e,o)=>{try{console.log("[AuthContext] Tentando login...");let t=e.replace(/\D/g,""),l=await s.default.get(`https://n8n.fehshop.com/webhook/usuarios/login?cpf=${t}&password=${encodeURIComponent(o)}`,{headers:{"Content-Type":"application/json"},timeout:1e4});console.log("[AuthContext] âœ… Resposta do login:",l.data);let a=l.data.user||l.data;if(a&&a.id){if(a.status===r.UserStatus.PENDING&&a.role===r.UserRole.VENDEDOR)throw console.log("[AuthContext] âš ï¸ UsuÃ¡rio PENDING"),Error("PENDING");if(a.status===r.UserStatus.REJECTED)throw console.log("[AuthContext] âŒ UsuÃ¡rio REJECTED"),Error("REJECTED");let{password:e,...o}=a;return n(o),localStorage.setItem("currentUser",JSON.stringify(o)),localStorage.setItem("userData",JSON.stringify(o)),console.log("[AuthContext] âœ… Login realizado com sucesso"),console.log("[AuthContext] ðŸ’¾ Dados salvos no localStorage"),!0}return console.log("[AuthContext] âŒ UsuÃ¡rio nÃ£o encontrado"),!1}catch(e){if(e instanceof Error&&("PENDING"===e.message||"REJECTED"===e.message))throw e;if(s.default.isAxiosError(e)&&e.response?.status===401)return console.log("[AuthContext] âŒ Credenciais invÃ¡lidas"),!1;return console.error("[AuthContext] âŒ Erro no login:",e),!1}},c=a?.role===r.UserRole.DEV||a?.role===r.UserRole.ADMIN;return(0,o.jsx)(l.Provider,{value:{user:a,login:u,logout:()=>{n(null),localStorage.removeItem("currentUser"),localStorage.removeItem("userData"),console.log("[AuthContext] ðŸšª Logout realizado - dados removidos do localStorage")},isAuthenticated:!!a,hasRole:e=>!!a&&(a.role===r.UserRole.DEV||a.role===e),canAccessUsers:c},children:e})}function n(){let e=(0,t.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}e.s(["AuthProvider",()=>a,"useAuth",()=>n])}]);