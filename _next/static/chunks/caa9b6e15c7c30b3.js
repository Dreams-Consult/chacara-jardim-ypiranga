(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51364,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(83642),t=e.i(73297),o=e.i(18566),l=e.i(81949);let i="http://192.168.18.163:5678/webhook";function d(){let{canAccessUsers:e,user:d}=(0,a.useAuth)(),n=(0,o.useRouter)(),[c,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(!0),[p,g]=(0,s.useState)(!1),[h,b]=(0,s.useState)(null),[f,j]=(0,s.useState)({name:"",email:"",cpf:"",role:t.UserRole.VENDEDOR,password:""});(0,s.useEffect)(()=>{e?y():n.push("/admin/dashboard")},[e,n]);let y=async()=>{try{console.log("[UsersPage] Carregando usuários..."),x(!0);let e=await l.default.get(`${i}/usuarios/`,{headers:{"Content-Type":"application/json"},timeout:1e4});console.log("[UsersPage] ✅ Usuários carregados:",e.data);let r=Array.isArray(e.data)?e.data:e.data.users||[];u(r)}catch(e){console.error("[UsersPage] ❌ Erro ao carregar usuários:",e),alert("Erro ao carregar usuários")}finally{x(!1)}},N=async e=>{e.preventDefault();try{if(h){console.log("[UsersPage] Atualizando usuário:",h.id);let e=new URLSearchParams({name:f.name,email:f.email,cpf:f.cpf.replace(/\D/g,""),role:f.role,...f.password&&{password:f.password}});await l.default.put(`${i}/usuarios/atualizar/${h.id}?${e.toString()}`,null,{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[UsersPage] ✅ Usuário atualizado"),alert("Usuário atualizado com sucesso!")}else{console.log("[UsersPage] Criando novo usuário");let e={name:f.name,email:f.email,cpf:f.cpf.replace(/\D/g,""),role:f.role,status:t.UserStatus.APPROVED,password:f.password};await l.default.post(`${i}/usuarios/criar`,e,{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[UsersPage] ✅ Usuário criado"),alert("Usuário criado com sucesso!")}await y(),U()}catch(e){console.error("[UsersPage] ❌ Erro ao salvar usuário:",e),l.default.isAxiosError(e)&&e.response?.data?.message?alert(e.response.data.message):alert("Erro ao salvar usuário")}},v=async e=>{try{console.log("[UsersPage] Aprovando usuário:",e),await l.default.put(`${i}/usuarios/aprovar`,{idUser:e,status:t.UserStatus.APPROVED},{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[UsersPage] ✅ Usuário aprovado"),alert("Usuário aprovado com sucesso!"),await y()}catch(e){console.error("[UsersPage] ❌ Erro ao aprovar usuário:",e),alert("Erro ao aprovar usuário")}},w=async e=>{if(confirm("Tem certeza que deseja rejeitar este usuário?"))try{console.log("[UsersPage] Rejeitando usuário:",e),await l.default.put(`${i}/usuarios/rejeitar`,{idUser:e,status:t.UserStatus.REJECTED},{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[UsersPage] ✅ Usuário rejeitado"),alert("Usuário rejeitado!"),await y()}catch(e){console.error("[UsersPage] ❌ Erro ao rejeitar usuário:",e),alert("Erro ao rejeitar usuário")}},U=()=>{j({name:"",email:"",cpf:"",role:t.UserRole.VENDEDOR,password:""}),g(!1),b(null)};return e?m?(0,r.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Carregando usuários..."})]})})}):(0,r.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Gerenciamento de Usuários"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Crie e gerencie usuários do sistema"})]}),!p&&(0,r.jsxs)("button",{onClick:()=>g(!0),className:"bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Novo Usuário"]})]}),c.filter(e=>e.status===t.UserStatus.PENDING).length>0&&(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden mb-6",children:[(0,r.jsx)("div",{className:"bg-amber-50 border-b-2 border-amber-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"bg-amber-500 text-white p-2 rounded-lg",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-amber-900",children:"Cadastros Pendentes de Aprovação"}),(0,r.jsxs)("p",{className:"text-amber-700 text-sm",children:[c.filter(e=>e.status===t.UserStatus.PENDING).length," vendedor(es) aguardando confirmação"]})]})]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CPF"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CRECI"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perfil"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:c.filter(e=>e.status===t.UserStatus.PENDING).map(e=>{var s;let a,o;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e.email})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-600 font-mono",children:e.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e.creci||"-"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(s=e.role,a={[t.UserRole.DEV]:"bg-purple-100 text-purple-800 border-purple-200",[t.UserRole.ADMIN]:"bg-blue-100 text-blue-800 border-blue-200",[t.UserRole.VENDEDOR]:"bg-green-100 text-green-800 border-green-200"},o={[t.UserRole.DEV]:"Desenvolvedor",[t.UserRole.ADMIN]:"Administrador",[t.UserRole.VENDEDOR]:"Vendedor"},(0,r.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${a[s]}`,children:o[s]}))}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border bg-amber-100 text-amber-800 border-amber-200",children:"Pendente"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>v(e.id),className:"text-green-600 hover:text-green-800 font-medium",children:"Aprovar"}),(0,r.jsx)("button",{onClick:()=>w(e.id),className:"text-red-600 hover:text-red-800 font-medium",children:"Rejeitar"})]})})]},e.id)})})]})})]}),p&&(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6 mb-6 border border-gray-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:h?"Editar Usuário":"Novo Usuário"}),(0,r.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo"}),(0,r.jsx)("input",{type:"text",value:f.name,onChange:e=>j({...f,name:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"João da Silva"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,r.jsx)("input",{type:"email",value:f.email,onChange:e=>j({...f,email:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"joao@email.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),(0,r.jsx)("input",{type:"text",value:f.cpf,onChange:e=>j({...f,cpf:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"000.000.000-00",maxLength:14})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Perfil"}),(0,r.jsxs)("select",{value:f.role,onChange:e=>j({...f,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[d?.role===t.UserRole.DEV&&(0,r.jsx)("option",{value:t.UserRole.DEV,children:"Desenvolvedor"}),(0,r.jsx)("option",{value:t.UserRole.ADMIN,children:"Administrador"}),(0,r.jsx)("option",{value:t.UserRole.VENDEDOR,children:"Vendedor"})]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Senha ",h&&"(deixe em branco para manter a atual)"]}),(0,r.jsx)("input",{type:"password",value:f.password,onChange:e=>j({...f,password:e.target.value}),required:!h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"••••••••",minLength:6})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:h?"Salvar Alterações":"Criar Usuário"}),(0,r.jsx)("button",{type:"button",onClick:U,className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors",children:"Cancelar"})]})]})]})]}):null}e.s(["default",()=>d])}]);