(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18333,e=>{"use strict";var t=e.i(71645);function a(e,o=5e3){(0,t.useEffect)(()=>{let t=setInterval(()=>{e()},o);return()=>clearInterval(t)},[e,o])}e.s(["useRealtimeUpdates",()=>a])},31886,e=>{"use strict";var t=e.i(43476),a=e.i(73297),o=e.i(71645);function r({imageUrl:e,lots:r,onLotClick:s,isEditMode:l=!1,onAreaDrawn:n,selectedLotId:i,drawingMode:d="polygon",previewArea:c=null}){let{canvasRef:u,imageRef:m,containerRef:h,hoveredLot:g,drawingPoints:x,scale:p,handleCanvasClick:b,handleCanvasMouseMove:f,handleMouseDown:y,handleMouseUp:v,handleContextMenu:N,handleTouchStart:j,handleTouchMove:w,handleTouchEnd:L,handleZoomIn:S,handleZoomOut:E,handleResetZoom:R,handleFinishDrawing:A,handleCancelDrawing:D}=function({imageUrl:e,lots:t,onLotClick:r,isEditMode:s=!1,onAreaDrawn:l,selectedLotId:n,drawingMode:i="polygon",previewArea:d=null}){let c=(0,o.useRef)(null),u=(0,o.useRef)(null),m=(0,o.useRef)(null),[h,g]=(0,o.useState)([]),[x,p]=(0,o.useState)(null),[b,f]=(0,o.useState)(!1),[y,v]=(0,o.useState)(1),[N,j]=(0,o.useState)({x:0,y:0}),[w,L]=(0,o.useState)(!1),[S,E]=(0,o.useState)({x:0,y:0}),[R,A]=(0,o.useState)(null),[D,C]=(0,o.useState)(1),[M,k]=(0,o.useState)({x:0,y:0}),[V,I]=(0,o.useState)(null),[$,T]=(0,o.useState)(!1),[B,P]=(0,o.useState)(null),[O,z]=(0,o.useState)(null),U=(0,o.useCallback)(()=>{let e=c.current,o=u.current;if(!e||!o||!b)return;let r=e.getContext("2d");if(r){if(r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.clearRect(0,0,e.width,e.height),r.save(),r.translate(N.x,N.y),r.scale(y,y),r.drawImage(o,0,0),t.forEach(e=>{((e,t,o,r)=>{if(t.area.points.length<3)return;e.beginPath(),e.moveTo(t.area.points[0].x,t.area.points[0].y),t.area.points.forEach(t=>{e.lineTo(t.x,t.y)}),e.closePath();let s="rgba(34, 197, 94, 0.3)",l="#22c55e";t.status===a.LotStatus.RESERVED?(s="rgba(251, 191, 36, 0.3)",l="#fbbf24"):t.status===a.LotStatus.SOLD&&(s="rgba(239, 68, 68, 0.3)",l="#ef4444"),o&&(s=s.replace("0.3","0.5"),l="#000"),r&&(s="rgba(59, 130, 246, 0.5)",l="#3b82f6"),e.fillStyle=s,e.fill(),e.strokeStyle=l,e.lineWidth=o||r?3:2,e.stroke()})(r,e,e.id===x?.id,e.id===n)}),s&&"polygon"===i&&h.length>0&&(r.beginPath(),r.moveTo(h[0].x,h[0].y),h.forEach(e=>{r.lineTo(e.x,e.y)}),r.strokeStyle="#3b82f6",r.lineWidth=2/y,r.stroke(),h.forEach(e=>{r.beginPath(),r.arc(e.x,e.y,5/y,0,2*Math.PI),r.fillStyle="#3b82f6",r.fill()})),s&&"rectangle"===i&&$&&B&&O){let e=O.x-B.x,t=O.y-B.y;r.strokeStyle="#3b82f6",r.fillStyle="rgba(59, 130, 246, 0.2)",r.lineWidth=2/y,r.strokeRect(B.x,B.y,e,t),r.fillRect(B.x,B.y,e,t)}s&&d&&d.points.length>=3&&(r.beginPath(),r.moveTo(d.points[0].x,d.points[0].y),d.points.forEach(e=>{r.lineTo(e.x,e.y)}),r.closePath(),r.fillStyle="rgba(34, 197, 94, 0.3)",r.fill(),r.strokeStyle="#22c55e",r.lineWidth=3/y,r.stroke(),d.points.forEach(e=>{r.beginPath(),r.arc(e.x,e.y,6/y,0,2*Math.PI),r.fillStyle="#22c55e",r.fill(),r.strokeStyle="#fff",r.lineWidth=2/y,r.stroke()})),r.restore()}},[b,t,h,x,n,s,y,N,i,$,B,O,d]);(0,o.useEffect)(()=>{let t=c.current,a=u.current;if(!t||!a||!e||""===e.trim())return;let o=()=>{t.width=a.naturalWidth,t.height=a.naturalHeight,f(!0)},r=()=>{console.error("Erro ao carregar imagem do mapa")};return a.addEventListener("load",o),a.addEventListener("error",r),a.src=e,()=>{a.removeEventListener("load",o),a.removeEventListener("error",r)}},[e]),(0,o.useEffect)(()=>{U()},[U]);let Y=(e,t,a)=>{let o=!1;for(let r=0,s=a.length-1;r<a.length;s=r++){let l=a[r].x,n=a[r].y,i=a[s].x,d=a[s].y;n>t!=d>t&&e<(i-l)*(t-n)/(d-n)+l&&(o=!o)}return o},X=e=>{let t=c.current;if(!t)return{x:0,y:0};let a=t.getBoundingClientRect(),o=e.clientX-a.left,r=e.clientY-a.top,s=t.width/a.width,l=t.height/a.height;return{x:(o*s-N.x)/y,y:(r*l-N.y)/y}},W=(0,o.useCallback)(e=>{e.preventDefault();let t=c.current;if(!t)return;let a=t.getBoundingClientRect(),o=e.clientX-a.left,r=e.clientY-a.top,s=t.width/a.width,l=t.height/a.height,n=o*s,i=r*l,d=(n-N.x)/y,u=(i-N.y)/y,m=Math.max(.5,Math.min(y+(e.deltaY>0?-.1:.1),5));v(m),j({x:n-d*m,y:i-u*m})},[y,N]),Z=(e,t)=>{let a=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(a*a+o*o)},F=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2});return(0,o.useEffect)(()=>{let e=c.current;if(e)return e.addEventListener("wheel",W,{passive:!1}),()=>{e.removeEventListener("wheel",W)}},[W]),{canvasRef:c,imageRef:u,containerRef:m,hoveredLot:x,drawingPoints:h,scale:y,handleCanvasClick:e=>{if(w||$)return;let{x:a,y:o}=X(e);if(s&&"polygon"===i)g([...h,{x:a,y:o}]);else if(!s){let e=t.find(e=>Y(a,o,e.area.points));e&&r&&r(e)}},handleCanvasMouseMove:e=>{let a=c.current;if(!a)return;if(w){let t=a.getBoundingClientRect(),o=a.width/t.width,r=a.height/t.height,s=(e.clientX-S.x)*o,l=(e.clientY-S.y)*r;j(e=>({x:e.x+s,y:e.y+l})),E({x:e.clientX,y:e.clientY});return}if($&&B){let{x:t,y:a}=X(e);z({x:t,y:a});return}if(s)return;let{x:o,y:r}=X(e),l=t.find(e=>Y(o,r,e.area.points));p(l||null),l?a.style.cursor="pointer":a.style.cursor="default"},handleMouseDown:e=>{if(2===e.button)e.preventDefault(),L(!0),E({x:e.clientX,y:e.clientY}),c.current&&(c.current.style.cursor="grabbing");else if(0===e.button&&s&&"rectangle"===i){let{x:t,y:a}=X(e);T(!0),P({x:t,y:a}),z({x:t,y:a})}},handleMouseUp:e=>{if(L(!1),c.current&&(c.current.style.cursor="default"),$&&B&&l){let t=X(e),a=Math.min(B.x,t.x),o=Math.max(B.x,t.x),r=Math.min(B.y,t.y),s=Math.max(B.y,t.y),n=s-r;if(o-a>10&&n>10){let e=[{x:a,y:r},{x:o,y:r},{x:o,y:s},{x:a,y:s}];console.log("üìê Ret√¢ngulo criado:",{start:B,end:t,points:e}),l({points:e})}T(!1),P(null),z(null)}},handleContextMenu:e=>{e.preventDefault()},handleTouchStart:e=>{if(2===e.touches.length){let t=Z(e.touches[0],e.touches[1]),a=F(e.touches[0],e.touches[1]),o=c.current;if(!o)return;let r=o.getBoundingClientRect(),s=a.x-r.left,l=a.y-r.top;A(t),C(y),k({x:N.x,y:N.y}),I({x:s,y:l})}else 1!==e.touches.length||s||(L(!0),E({x:e.touches[0].clientX-N.x,y:e.touches[0].clientY-N.y}))},handleTouchMove:e=>{if(2===e.touches.length&&null!==R&&V){e.preventDefault();let t=c.current;if(!t)return;let a=t.getBoundingClientRect(),o=F(e.touches[0],e.touches[1]),r=o.x-a.left,s=o.y-a.top,l=Math.max(.5,Math.min(Z(e.touches[0],e.touches[1])/R*D,5)),n=t.width/a.width,i=t.height/a.height,d=V.x*n,u=V.y*i,m=(d-M.x)/D,h=(u-M.y)/D;v(l),j({x:r*n-m*l,y:s*i-h*l})}else 1===e.touches.length&&w&&!s&&(e.preventDefault(),j({x:e.touches[0].clientX-S.x,y:e.touches[0].clientY-S.y}))},handleTouchEnd:()=>{A(null),I(null),L(!1)},handleZoomIn:()=>{v(e=>Math.min(e+.2,5))},handleZoomOut:()=>{v(e=>Math.max(e-.2,.5))},handleResetZoom:()=>{v(1),j({x:0,y:0})},handleFinishDrawing:()=>{"polygon"===i&&h.length>=3&&l&&(l({points:h}),g([]))},handleCancelDrawing:()=>{g([]),T(!1),P(null),z(null)}}}({imageUrl:e,lots:r,onLotClick:s,isEditMode:l,onAreaDrawn:n,selectedLotId:i,drawingMode:d,previewArea:c});return(0,t.jsxs)("div",{ref:h,className:"relative",children:[e&&""!==e.trim()?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{ref:m,src:e,alt:"Map",className:"hidden"}),(0,t.jsx)("canvas",{ref:u,onClick:b,onMouseMove:f,onMouseDown:y,onMouseUp:v,onMouseLeave:v,onContextMenu:N,onTouchStart:j,onTouchMove:w,onTouchEnd:L,className:"border border-gray-300 rounded-lg shadow-lg cursor-crosshair max-w-full"})]}):(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center bg-gray-50",children:[(0,t.jsx)("svg",{className:"w-24 h-24 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-gray-600 font-medium mb-2",children:"Nenhuma imagem do mapa carregada"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Adicione uma imagem ao mapa para come√ßar a desenhar os lotes"})]}),(0,t.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:[(0,t.jsx)("button",{onClick:S,className:"bg-white hover:bg-gray-50 text-gray-800 font-bold py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl cursor-pointer",title:"Zoom In",children:"+"}),(0,t.jsx)("button",{onClick:E,className:"bg-white hover:bg-gray-50 text-gray-800 font-bold py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl cursor-pointer",title:"Zoom Out",children:"-"}),(0,t.jsx)("button",{onClick:R,className:"bg-white hover:bg-gray-50 text-gray-800 font-medium py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl text-xs cursor-pointer",title:"Reset Zoom",children:"Reset"}),(0,t.jsxs)("div",{className:"bg-white px-3 py-1 rounded-lg shadow-lg border border-gray-200 text-xs text-gray-700 text-center",children:[Math.round(100*p),"%"]})]}),l&&"polygon"===d&&x.length>0&&(0,t.jsxs)("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[(0,t.jsxs)("button",{onClick:A,className:"px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 shadow-lg transition-all hover:shadow-xl disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none cursor-pointer",disabled:x.length<3,children:["Finalizar √Årea (",x.length," pontos)"]}),(0,t.jsx)("button",{onClick:D,className:"px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 shadow-lg transition-all hover:shadow-xl cursor-pointer",children:"Cancelar"})]}),l&&"rectangle"===d&&!c&&(0,t.jsx)("div",{className:"absolute bottom-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg",children:(0,t.jsx)("p",{className:"font-medium",children:"üî≤ Modo Ret√¢ngulo: Clique e arraste para desenhar"})}),l&&c&&c.points.length>=3&&(0,t.jsx)("div",{className:"absolute bottom-4 left-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg",children:(0,t.jsx)("p",{className:"font-medium",children:"‚úÖ √Årea selecionada - Complete as informa√ß√µes do lote"})}),g&&!l&&(0,t.jsxs)("div",{className:"absolute top-4 left-4 bg-white p-4 rounded-lg shadow-xl border border-gray-200",children:[(0,t.jsxs)("h3",{className:"font-bold text-lg text-gray-900 mb-2",children:["Lote ",g.lotNumber]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Status:"})," ",(0,t.jsx)("span",{className:g.status===a.LotStatus.AVAILABLE?"font-semibold text-green-700":g.status===a.LotStatus.RESERVED?"font-semibold text-amber-700":"font-semibold text-red-700",children:g.status===a.LotStatus.AVAILABLE?"Dispon√≠vel":g.status===a.LotStatus.RESERVED?"Reservado":"Vendido"})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"√Årea:"})," ",g.size,"m¬≤"]}),(0,t.jsxs)("p",{className:"text-base font-bold text-gray-900 mt-2",children:["R$ ",g.price.toLocaleString("pt-BR")]})]})]})}e.s(["default",()=>r],31886)},25863,e=>{"use strict";var t=e.i(43476),a=e.i(71645),o=e.i(18566),r=e.i(83642),s=e.i(73297);e.i(47167);var l=e.i(81949),n=e.i(31886),i=e.i(18333);let d="http://192.168.18.163:5678/webhook";function c(){let e=(0,o.useSearchParams)(),r=(0,o.useRouter)(),c=e.get("mapId")||"",[u,m]=(0,a.useState)(null),[h,g]=(0,a.useState)([]),[x,p]=(0,a.useState)(!1),[b,f]=(0,a.useState)(null),[y,v]=(0,a.useState)(),[N,j]=(0,a.useState)(!0),[w,L]=(0,a.useState)("rectangle"),[S,E]=(0,a.useState)(null),R=(0,a.useCallback)(async()=>{if(c)try{console.log(`[LotManagement] üîÑ Carregando dados do mapa ${c}...`);let e=await l.default.get(`${d}/mapas/lotes`,{params:{mapId:c},timeout:1e4});console.log("[LotManagement] ‚úÖ Resposta recebida:",e.data);let t=e.data[0];if(t){let e={id:t.mapId||t.id||c,name:t.name||`Mapa ${t.mapId||c}`,description:t.description||"",imageUrl:t.imageUrl||"",imageType:"image",width:t.width||800,height:t.height||600,createdAt:t.createdAt?new Date(t.createdAt):new Date,updatedAt:t.updatedAt?new Date(t.updatedAt):new Date};if(m(e),t.lots&&Array.isArray(t.lots)){let e=t.lots.map(e=>{let a=e.area;if(e.area&&"string"==typeof e.area.points)try{a={...e.area,points:JSON.parse(e.area.points)},console.log("[LotManagement] üîß Area.points parseado:",a.points)}catch(e){console.error("[LotManagement] ‚ùå Erro ao parsear area.points:",e)}return{...e,area:a,mapId:t.mapId||c,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}});console.log("[LotManagement] üìç Lotes carregados:",e.map(e=>({id:e.id,lotNumber:e.lotNumber,pointsCount:e.area?.points?.length||0,firstPoint:e.area?.points?.[0],lastPoint:e.area?.points?.[e.area?.points?.length-1]}))),g(e)}else g([])}}catch(e){console.error("[LotManagement] ‚ùå Erro ao buscar dados:",e),m({id:c,name:`Mapa ${c}`,description:"",imageUrl:"",imageType:"image",width:800,height:600,createdAt:new Date,updatedAt:new Date}),g([]),alert("Erro ao carregar dados do mapa. Usando valores padr√£o.")}finally{j(!1)}},[c]);(0,a.useEffect)(()=>{R()},[R]),(0,i.useRealtimeUpdates)(()=>{x||b||R()},3e3);let A=async()=>{try{console.log("[LotManagement] üîÑ Recarregando lotes...");let e=await l.default.get(`${d}/mapas/lotes`,{params:{mapId:c},timeout:1e4});console.log("[LotManagement] ‚úÖ Lotes recarregados:",e.data);let t=e.data[0];if(t)if(t.lots&&Array.isArray(t.lots)){let e=t.lots.map(e=>{let a=e.area;if(e.area&&"string"==typeof e.area.points)try{a={...e.area,points:JSON.parse(e.area.points)}}catch(e){console.error("[LotManagement] ‚ùå Erro ao parsear area.points no reload:",e)}return{...e,area:a,mapId:t.mapId||c,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}});g(e)}else g([])}catch(e){console.error("Erro ao recarregar lotes:",e)}},D=async e=>{try{console.log("[LotManagement] üì§ Salvando lote:",e),await l.default.post(`${d}/mapas/lotes/criar`,e,{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[LotManagement] ‚úÖ Lote salvo com sucesso"),await A()}catch(e){throw console.error("[LotManagement] ‚ùå Erro ao salvar lote:",e),e}},C=async e=>{try{console.log(`[LotManagement] üóëÔ∏è Deletando lote ${e}...`),await l.default.delete(`${d}/mapas/lotes/deletar`,{params:{lotId:e},timeout:1e4}),console.log("[LotManagement] ‚úÖ Lote deletado com sucesso"),await A()}catch(e){throw console.error("[LotManagement] ‚ùå Erro ao deletar lote:",e),e}},M=async(e,t)=>{try{console.log(`[LotManagement] üîÑ Atualizando status do lote ${e} para ${t}...`),await l.default.put(`${d}/mapas/lotes/comprar`,{lotId:e,status:t},{headers:{"Content-Type":"application/json"},timeout:1e4}),console.log("[LotManagement] ‚úÖ Status atualizado com sucesso"),await A()}catch(e){throw console.error("[LotManagement] ‚ùå Erro ao atualizar status:",e),e}},k=e=>{e!==w&&(b&&f({...b,area:{points:[]}}),E(null),L(e))},V=async e=>{try{console.log(`üîç Validando n\xfamero do lote ${e} para o mapa ${c}...`);let t=await l.default.get(`${d}/mapas/lotes/numero-valido`,{params:{mapId:c,lotNumber:e}}),a=0===t.data.lotExists;return console.log(`‚úÖ Resultado da valida\xe7\xe3o (lotExists: ${t.data.lotExists}):`,a?"N√∫mero dispon√≠vel":"N√∫mero j√° existe"),a}catch(e){return console.error("‚ùå Erro ao validar n√∫mero do lote:",e),alert("Erro ao validar o n√∫mero do lote. Tente novamente."),!1}},I=async()=>{if(!b)return void alert("Nenhum lote em edi√ß√£o");if(!b.lotNumber||""===b.lotNumber.trim())return void alert("‚ùå N√∫mero do lote √© obrigat√≥rio");let e=h.find(e=>e.id===b.id);if((!e||e.lotNumber!==b.lotNumber)&&!await V(b.lotNumber))return void alert(`‚ùå O n\xfamero do lote "${b.lotNumber}" j\xe1 est\xe1 em uso. Escolha outro n\xfamero.`);if(b.area.points.length<3)return void alert("‚ùå Desenhe a √°rea do lote no mapa (m√≠nimo 3 pontos)");if(!b.price||b.price<=0)return void alert("‚ùå Informe o pre√ßo do lote");if(!b.size||b.size<=0)return void alert("‚ùå Informe o tamanho do lote (m¬≤)");let t={...b,mapId:c,updatedAt:new Date};console.log("üíæ Salvando lote:",{id:t.id,lotNumber:t.lotNumber,pointsCount:t.area.points.length,points:t.area.points,firstPoint:t.area.points[0],lastPoint:t.area.points[t.area.points.length-1]});try{await D(t),p(!1),f(null),v(void 0),E(null)}catch(e){console.error("Erro ao salvar:",e),alert("Erro ao salvar lote. Tente novamente.")}},$=async e=>{if(confirm("Tem certeza que deseja excluir este lote?"))try{await C(e)}catch(e){console.error("Erro ao deletar:",e),alert("Erro ao deletar lote. Tente novamente.")}},T=async(e,t)=>{let a=h.find(t=>t.id===e);if(!a)return;let o={[s.LotStatus.AVAILABLE]:"Dispon√≠vel",[s.LotStatus.RESERVED]:"Reservado",[s.LotStatus.SOLD]:"Vendido"};if(t===s.LotStatus.SOLD&&a.status!==s.LotStatus.RESERVED)return void alert(`‚ùå N\xe3o \xe9 poss\xedvel finalizar a compra do lote ${a.lotNumber}.

O lote precisa estar com status "Reservado" antes de ser marcado como "Vendido".`);if(confirm(`Alterar status do lote ${a.lotNumber} para "${o[t]}"?`))try{await M(e,t)}catch(e){console.error("Erro ao atualizar status:",e),alert("Erro ao atualizar status. Tente novamente.")}},B=e=>{f(e),p(!0),v(e.id)},P=e=>{if(b){if(e===s.LotStatus.SOLD&&b.status!==s.LotStatus.RESERVED)return void alert(`‚ùå N\xe3o \xe9 poss\xedvel marcar o lote como "Vendido".

O lote precisa estar com status "Reservado" antes de ser marcado como "Vendido".`);f({...b,status:e})}};return N||!u?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("p",{className:"text-gray-600",children:"Carregando..."})}):(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("button",{onClick:()=>r.push("/admin/maps"),className:"text-blue-700 hover:text-blue-900 font-medium hover:underline mb-2 transition-colors cursor-pointer",children:"‚Üê Voltar para Mapas"}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:u.name}),u.description&&(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:u.description})]}),(0,t.jsxs)("div",{className:"flex gap-3 items-center",children:[x&&(0,t.jsxs)("div",{className:"flex gap-2 border border-gray-300 rounded-lg p-1 bg-gray-50",children:[(0,t.jsx)("button",{onClick:()=>k("rectangle"),className:`px-3 py-1.5 rounded font-medium text-sm transition-all cursor-pointer ${"rectangle"===w?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100"}`,title:"Desenhar ret√¢ngulo (clicar e arrastar)",children:"üî≤ Ret√¢ngulo"}),(0,t.jsx)("button",{onClick:()=>k("polygon"),className:`px-3 py-1.5 rounded font-medium text-sm transition-all cursor-pointer ${"polygon"===w?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100"}`,title:"Desenhar pol√≠gono (clicar ponto a ponto)",children:"üìê Pol√≠gono"})]}),(0,t.jsx)("button",{onClick:()=>{f({id:"",mapId:c,lotNumber:"",area:{points:[]},status:s.LotStatus.AVAILABLE,price:0,size:0,description:"",features:[],createdAt:new Date,updatedAt:new Date}),p(!0),v(void 0),E(null)},className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 shadow-md transition-all hover:shadow-lg cursor-pointer",children:"Novo Lote"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(n.default,{imageUrl:u.imageUrl,lots:h,isEditMode:x,onAreaDrawn:e=>{b&&(console.log(`üìê \xc1rea desenhada recebida (modo: ${w}):`,{mode:w,pointsCount:e.points.length,points:e.points,firstPoint:e.points[0],lastPoint:e.points[e.points.length-1]}),f({...b,area:e}),E(e))},selectedLotId:y,drawingMode:w,previewArea:S,onLotClick:e=>{x||B(e)}})}),(0,t.jsxs)("div",{className:"space-y-4",children:[x&&b&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:[b.area.points.length>0?"Editar":"Novo"," Lote"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"N√∫mero do Lote"}),(0,t.jsx)("input",{type:"text",value:b.lotNumber,onChange:e=>f({...b,lotNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: 01, A1, etc"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:b.status,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer",children:[(0,t.jsx)("option",{value:s.LotStatus.AVAILABLE,children:"Dispon√≠vel"}),(0,t.jsx)("option",{value:s.LotStatus.RESERVED,children:"Reservado"}),(0,t.jsx)("option",{value:s.LotStatus.SOLD,children:"Vendido"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"√Årea (m¬≤)"}),(0,t.jsx)("input",{type:"number",value:b.size||"",onChange:e=>f({...b,size:""===e.target.value?0:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"300"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Pre√ßo (R$)"}),(0,t.jsx)("input",{type:"number",value:b.price||"",onChange:e=>f({...b,price:""===e.target.value?0:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"50000"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:b.status,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer",children:[(0,t.jsx)("option",{value:s.LotStatus.AVAILABLE,children:"Dispon√≠vel"}),(0,t.jsx)("option",{value:s.LotStatus.RESERVED,children:"Reservado"}),(0,t.jsx)("option",{value:s.LotStatus.SOLD,children:"Vendido"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Descri√ß√£o"}),(0,t.jsx)("textarea",{value:b.description,onChange:e=>f({...b,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Descri√ß√£o do lote"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Caracter√≠sticas (separadas por v√≠rgula)"}),(0,t.jsx)("input",{type:"text",value:b.features?.join(", ")||"",onChange:e=>f({...b,features:e.target.value.split(",").map(e=>e.trim())}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"√Ågua, Luz, Portaria"})]}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,t.jsx)("p",{className:"text-sm text-blue-800 font-medium",children:0===b.area.points.length?"üëÜ Clique no mapa para desenhar a √°rea do lote":`‚úì ${b.area.points.length} pontos desenhados`})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:I,className:"flex-1 px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 shadow-sm transition-all hover:shadow-md disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none cursor-pointer",disabled:b.area.points.length<3,children:"Salvar"}),(0,t.jsx)("button",{onClick:()=>{p(!1),f(null),v(void 0),E(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 shadow-sm transition-colors cursor-pointer",children:"Cancelar"})]})]})]}),!x&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Lotes Cadastrados"}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[h.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-bold text-gray-900",children:["Lote ",e.lotNumber]}),(0,t.jsx)("p",{className:"text-sm font-medium",children:(0,t.jsx)("span",{className:e.status===s.LotStatus.AVAILABLE?"text-green-700":e.status===s.LotStatus.RESERVED?"text-amber-700":"text-red-700",children:e.status===s.LotStatus.AVAILABLE?"Dispon√≠vel":e.status===s.LotStatus.RESERVED?"Reservado":"Vendido"})})]}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:["R$ ",e.price.toLocaleString("pt-BR")]})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"√Årea:"})," ",e.size,"m¬≤"]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>B(e),className:"flex-1 px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 transition-colors shadow-sm hover:shadow-md cursor-pointer",children:"Editar"}),(0,t.jsx)("button",{onClick:()=>$(e.id),className:"px-3 py-1 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition-colors shadow-sm hover:shadow-md cursor-pointer",children:"Excluir"})]}),e.status!==s.LotStatus.SOLD&&(0,t.jsxs)("div",{className:"flex gap-2",children:[e.status!==s.LotStatus.AVAILABLE&&(0,t.jsx)("button",{onClick:()=>T(e.id,s.LotStatus.AVAILABLE),className:"flex-1 px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded hover:bg-green-200 transition-colors cursor-pointer",children:"‚úì Marcar Dispon√≠vel"}),e.status!==s.LotStatus.RESERVED&&(0,t.jsx)("button",{onClick:()=>T(e.id,s.LotStatus.RESERVED),className:"flex-1 px-3 py-1 bg-amber-100 text-amber-800 text-xs font-medium rounded hover:bg-amber-200 transition-colors cursor-pointer",children:"‚è∏ Marcar Reservado"}),(0,t.jsx)("button",{onClick:()=>T(e.id,s.LotStatus.SOLD),className:"flex-1 px-3 py-1 bg-red-100 text-red-800 text-xs font-medium rounded hover:bg-red-200 transition-colors cursor-pointer",children:"‚úï Marcar Vendido"})]}),e.status===s.LotStatus.SOLD&&(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)("button",{onClick:()=>T(e.id,s.LotStatus.AVAILABLE),className:"flex-1 px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded hover:bg-green-200 transition-colors cursor-pointer",children:"‚Üª Reverter para Dispon√≠vel"})})]})]},e.id)),0===h.length&&(0,t.jsx)("p",{className:"text-gray-600 text-sm text-center py-4",children:"Nenhum lote cadastrado"})]})]})]})]})]})}function u(){let e=(0,o.useRouter)(),{user:l}=(0,r.useAuth)();return((0,a.useEffect)(()=>{l?.role===s.UserRole.VENDEDOR&&(console.log("[LotManagement] ‚ö†Ô∏è Vendedor n√£o tem permiss√£o - redirecionando"),e.push("/admin/dashboard"))},[l,e]),l?.role===s.UserRole.VENDEDOR)?null:(0,t.jsx)(c,{})}function m(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"p-6 text-center",children:"Carregando..."}),children:(0,t.jsx)(u,{})})}e.s(["default",()=>m],25863)}]);