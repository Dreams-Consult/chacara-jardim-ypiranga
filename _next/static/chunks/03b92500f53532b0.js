(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18333,e=>{"use strict";var a=e.i(71645);function r(e,t=5e3){(0,a.useEffect)(()=>{let a=setInterval(()=>{e()},t);return()=>clearInterval(a)},[e,t])}e.s(["useRealtimeUpdates",()=>r])},10856,e=>{"use strict";var a=e.i(43476),r=e.i(71645),t=e.i(18566),o=e.i(83642),s=e.i(73297),n=e.i(22016);e.i(47167);var i=e.i(81949);let l=e=>(3*(e.length-(e.indexOf(",")+1))/4-("="===e.charAt(e.length-2)?2:+("="===e.charAt(e.length-1))))/1048576,d="http://localhost:5678/webhook-test/loteamento";var c=e.i(18333);function m(){let{maps:e,isLoading:t,deleteMapById:o,processFileUpload:s,loadMaps:m}=function(){let[e,a]=(0,r.useState)([]),[t,o]=(0,r.useState)(!0),s=(0,r.useCallback)(async()=>{try{let e=(await i.default.get(`${d}/mapas`)).data;if(!Array.isArray(e)){console.warn("API retornou dados inválidos ou sem mapas:",e),a([]);return}let r=e.map(e=>({id:e.mapId||e.id||"",name:e.name||`Mapa ${e.mapId||e.id}`,description:e.description||"",imageUrl:e.imageUrl||"",imageType:"image",width:e.width||800,height:e.height||600,createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date}));a(r)}catch(e){console.error("Erro ao buscar mapas:",e),a([]),alert("Erro ao carregar mapas. Verifique se a API está rodando.")}finally{o(!1)}},[]);(0,r.useEffect)(()=>{s()},[s]);let n=(0,r.useCallback)(async e=>{try{let a=await i.default.post(`${d}/mapas/criar`,e,{headers:{"Content-Type":"application/json"},timeout:1e4});return await s(),a.data}catch(e){throw console.error("Erro ao criar mapa:",e),e}},[s]),c=(0,r.useCallback)(async e=>{try{await i.default.delete(`${d}/mapas/deletar`,{params:{mapId:e},timeout:1e4}),await s()}catch(e){throw console.error("Erro ao deletar mapa:",e),e}},[s]),m=(0,r.useCallback)(async(e,a)=>new Promise((r,t)=>{let o=new FileReader;o.onload=async o=>{let s=o.target?.result;try{if(e.type.startsWith("image/")){let o=await ((e,a=1920,r=1080,t=.8)=>new Promise((o,s)=>{let n=new Image;n.onload=()=>{let e=document.createElement("canvas"),i=e.getContext("2d");if(!i)return void s(Error("Failed to get canvas context"));let l=n.width,d=n.height;l>a&&(d=d*a/l,l=a),d>r&&(l=l*r/d,d=r),e.width=l,e.height=d,i.drawImage(n,0,0,l,d),o(e.toDataURL("image/jpeg",t))},n.onerror=()=>{s(Error("Failed to load image"))},n.src=e}))(s,1920,1080,.7);if(l(o)>4){alert("Imagem muito grande! Por favor, use uma imagem menor ou de menor qualidade."),t(Error("Imagem muito grande"));return}let i=new Image;i.onload=async()=>{try{let t={name:a?.name||e.name,description:a?.description||"",imageUrl:o};await n(t),r()}catch(e){console.error("Erro ao salvar mapa:",e),alert(e instanceof Error?e.message:"Erro ao salvar mapa. Tente com uma imagem menor."),t(e)}},i.src=o}else if("application/pdf"===e.type){if(l(s)>4){alert("PDF muito grande! Por favor, converta para imagem primeiro usando o script convert-pdf.sh ou use uma ferramenta online."),t(Error("PDF muito grande"));return}try{let t={name:a?.name||e.name,description:a?.description||"",imageUrl:s};await n(t),r()}catch(e){console.error("Erro ao salvar PDF:",e),alert(e instanceof Error?e.message:"Erro ao salvar PDF. Converta para imagem primeiro."),t(e)}}}catch(e){console.error("Erro ao processar arquivo:",e),alert("Erro ao processar arquivo. Por favor, tente novamente com um arquivo menor."),t(e)}},o.readAsDataURL(e)}),[n]);return{maps:e,isLoading:t,loadMaps:s,createMap:n,deleteMapById:c,processFileUpload:m}}(),[h,u]=(0,r.useState)(!1),[p,x]=(0,r.useState)(null);(0,c.useRealtimeUpdates)(()=>{m()},3e3);let v=async e=>{let a=e.target.files?.[0];if(a)try{await s(a,p),u(!1),x(null)}catch(e){console.error("Erro ao processar arquivo:",e)}},f=async e=>{if(confirm("Tem certeza que deseja excluir este mapa e todos os lotes associados?"))try{await o(e)}catch(e){console.error("Erro ao deletar:",e),alert("Erro ao deletar mapa. Tente novamente.")}};return(0,a.jsxs)("div",{className:"min-h-screen bg-[var(--background)] p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Gerenciamento de Mapas"}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"px-5 py-2.5 bg-[var(--accent)] text-[#1c1c1c] font-semibold rounded-xl hover:bg-[var(--accent-light)] shadow-[var(--shadow-md)] transition-all hover:shadow-[var(--shadow-lg)] hover:-translate-y-0.5 cursor-pointer",children:"Novo Mapa"})]}),t?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-[var(--accent)]/20 rounded-full mb-4 shadow-md",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-[var(--accent)] animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,a.jsx)("p",{className:"text-white font-semibold",children:"Carregando mapas..."})]}):0!==e.length||h?null:(0,a.jsxs)("div",{className:"text-center py-12 bg-[var(--card-bg)] rounded-2xl border-2 border-dashed border-[var(--accent)]/40 shadow-[var(--shadow-md)]",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-[var(--accent)]/20 rounded-full mb-4 shadow-md",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-[var(--accent)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),(0,a.jsx)("p",{className:"text-white text-lg font-semibold mb-2",children:"Nenhum mapa cadastrado"}),(0,a.jsx)("p",{className:"text-white/70 text-sm font-medium",children:'Clique em "Novo Mapa" para começar'})]}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl w-full max-w-md shadow-2xl border-2 border-[var(--primary)]/30",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-[var(--foreground)] mb-6 flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-6 h-6 text-[var(--primary)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),"Novo Mapa"]}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-[var(--foreground)] mb-2",children:"Nome"}),(0,a.jsx)("input",{type:"text",value:p?.name||"",onChange:e=>x({...p,name:e.target.value}),className:"w-full px-4 py-2.5 bg-white border-2 border-[var(--border)] rounded-xl text-[var(--foreground)] font-medium focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] shadow-[var(--shadow-sm)]",placeholder:"Nome do mapa"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-[var(--foreground)] mb-2",children:"Descrição"}),(0,a.jsx)("textarea",{value:p?.description||"",onChange:e=>x({...p,description:e.target.value}),className:"w-full px-4 py-2.5 bg-white border-2 border-[var(--border)] rounded-xl text-[var(--foreground)] font-medium focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] shadow-[var(--shadow-sm)]",placeholder:"Descrição do mapa",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-[var(--foreground)] mb-2",children:"Upload de Imagem ou PDF"}),(0,a.jsx)("input",{type:"file",accept:"image/*,application/pdf",onChange:v,className:"w-full text-[var(--foreground)] font-medium file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-[var(--primary)]/10 file:text-[var(--primary)] hover:file:bg-[var(--primary)]/20"}),(0,a.jsxs)("p",{className:"text-xs text-[var(--warning-dark)] mt-2 bg-[var(--warning)]/10 p-3 rounded-xl border-2 border-[var(--warning)]/30 font-medium",children:["⚠️ ",(0,a.jsx)("span",{className:"font-bold",children:"Tamanho máximo recomendado: 4MB."})," A imagem será automaticamente comprimida. Para PDFs grandes, converta para imagem primeiro usando o script convert-pdf.sh"]})]})]}),(0,a.jsx)("div",{className:"flex gap-2 mt-6",children:(0,a.jsx)("button",{onClick:()=>{u(!1),x(null)},className:"flex-1 px-4 py-2.5 bg-[var(--surface)] text-[var(--foreground)] font-semibold rounded-xl hover:bg-[var(--surface-hover)] transition-colors shadow-[var(--shadow-sm)] cursor-pointer",children:"Cancelar"})})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,a.jsxs)("div",{className:"bg-white border-2 border-[var(--primary)]/30 rounded-2xl overflow-hidden shadow-[var(--shadow-lg)] hover:shadow-[var(--shadow-xl)] transition-shadow",children:[(0,a.jsx)("div",{className:"h-48 bg-gradient-to-br from-[var(--surface)] to-[var(--surface-hover)] flex items-center justify-center overflow-hidden",children:e.imageUrl&&""!==e.imageUrl.trim()?"image"===e.imageType?(0,a.jsx)("img",{src:e.imageUrl,alt:e.name,className:"max-w-full max-h-full object-contain"}):(0,a.jsxs)("div",{className:"text-[var(--foreground)] font-bold",children:["PDF: ",e.name]}):(0,a.jsxs)("div",{className:"text-[var(--foreground)]/60 text-center p-4",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto mb-2 text-[var(--primary)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-sm font-semibold",children:"Sem imagem"})]})}),(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)("h3",{className:"font-bold text-lg text-[var(--surface)] mb-2",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-[var(--surface)] font-medium mb-3",children:e.description}),(0,a.jsxs)("div",{className:"space-y-1 mb-4",children:[(0,a.jsxs)("p",{className:"text-xs text-[var(--surface)]/80 font-semibold",children:[(0,a.jsx)("span",{className:"font-bold",children:"Dimensões:"})," ",e.width," x ",e.height,"px"]}),(0,a.jsxs)("p",{className:"text-xs text-[var(--foreground)]/60 font-mono bg-[var(--surface)] px-2 py-1 rounded",children:["ID: ",e.id]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.default,{href:`/admin/lot-management?mapId=${e.id}`,className:"flex-1 px-4 py-2.5 bg-[var(--success)] text-white font-semibold rounded-xl hover:bg-[var(--success-dark)] text-center transition-all shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] hover:-translate-y-0.5 cursor-pointer",children:"Gerenciar Lotes"}),(0,a.jsx)("button",{onClick:()=>f(e.id),className:"px-4 py-2.5 bg-[var(--danger)] text-white font-semibold rounded-xl hover:bg-[var(--danger-dark)] transition-all shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)] hover:-translate-y-0.5 cursor-pointer",children:"Excluir"})]})]})]},e.id))}),0===e.length&&!h&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-[var(--foreground)] text-lg font-semibold",children:"Nenhum mapa cadastrado. Clique em “Novo Mapa” para começar."})})]})}function h(){let e=(0,t.useRouter)(),{user:n}=(0,o.useAuth)();return((0,r.useEffect)(()=>{n?.role===s.UserRole.VENDEDOR&&(console.log("[MapManagement] ⚠️ Vendedor não tem permissão - redirecionando"),e.push("/admin/dashboard"))},[n,e]),n?.role===s.UserRole.VENDEDOR)?null:(0,a.jsx)(m,{})}e.s(["default",()=>h],10856)}]);