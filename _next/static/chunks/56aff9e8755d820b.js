(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56563,73297,e=>{"use strict";var t,a=((t={}).AVAILABLE="available",t.RESERVED="reserved",t.SOLD="sold",t);e.s(["LotStatus",()=>a],73297);let s="lot_platform_maps",r="lot_platform_lots",l="lot_platform_purchases",o="lot_platform_initialized",i=e=>JSON.stringify(e,(e,t)=>t instanceof Date?t.toISOString():t),n=e=>JSON.parse(e,(e,t)=>"string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(t)?new Date(t):t),d=()=>{(()=>{if(localStorage.getItem(o))return;let e={id:"1762192028364",name:"Mapa de Exemplo - ChÃ¡cara Jardim Ypiranga",description:"Mapa de exemplo para testes. Substitua pela imagem real.",imageUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LXNpemU9IjI0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5NYXBhIGRlIEV4ZW1wbG88L3RleHQ+PC9zdmc+",imageType:"image",width:800,height:600,createdAt:new Date("2024-11-03T10:00:00"),updatedAt:new Date("2024-11-03T10:00:00")},t=[{id:"1",mapId:"1762192028364",lotNumber:"1",area:{points:[{x:100,y:100},{x:200,y:100},{x:200,y:200},{x:100,y:200}]},size:250,price:5e4,status:a.AVAILABLE,description:"Lote de exemplo 1",createdAt:new Date("2024-11-03T10:00:00"),updatedAt:new Date("2024-11-03T10:00:00")},{id:"2",mapId:"1762192028364",lotNumber:"2",area:{points:[{x:220,y:100},{x:320,y:100},{x:320,y:200},{x:220,y:200}]},size:250,price:55e3,status:a.AVAILABLE,description:"Lote de exemplo 2",createdAt:new Date("2024-11-03T10:00:00"),updatedAt:new Date("2024-11-03T10:00:00")},{id:"3",mapId:"1762192028364",lotNumber:"3",area:{points:[{x:100,y:220},{x:200,y:220},{x:200,y:320},{x:100,y:320}]},size:250,price:52e3,status:a.RESERVED,description:"Lote de exemplo 3",createdAt:new Date("2024-11-03T10:00:00"),updatedAt:new Date("2024-11-03T10:00:00")}];localStorage.setItem(s,i([e])),localStorage.setItem(r,i(t)),localStorage.setItem(l,i([])),localStorage.setItem(o,"true"),console.log("Dados de exemplo inicializados com sucesso!")})();let e=localStorage.getItem(s);return e?n(e):[]},c=()=>{let e=localStorage.getItem(r);return e?n(e):[]};e.s(["deleteLot",0,e=>{let t=c().filter(t=>t.id!==e);localStorage.setItem(r,i(t))},"deleteMap",0,e=>{let t=d().filter(t=>t.id!==e);localStorage.setItem(s,i(t));let a=c().filter(t=>t.mapId!==e);localStorage.setItem(r,i(a))},"getLots",0,c,"getLotsByMapId",0,e=>c().filter(t=>t.mapId===e),"getMapById",0,e=>d().find(t=>t.id===e),"getMaps",0,d,"saveLot",0,e=>{let t=c(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e),localStorage.setItem(r,i(t))},"saveMap",0,e=>{let t=d(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e);try{let e=i(t);localStorage.setItem(s,e)}catch(e){if(console.error("Erro ao salvar mapa:",e),e instanceof DOMException&&"QuotaExceededError"===e.name)throw Error("Arquivo muito grande para o localStorage. Use uma imagem menor ou de menor qualidade.");throw e}},"savePurchaseRequest",0,e=>{let t,a=(t=localStorage.getItem(l))?n(t):[];a.push(e),localStorage.setItem(l,i(a))}],56563)},18566,(e,t,a)=>{t.exports=e.r(76562)},31886,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(73297);function r({imageUrl:e,lots:r,onLotClick:l,isEditMode:o=!1,onAreaDrawn:i,selectedLotId:n}){let d=(0,a.useRef)(null),c=(0,a.useRef)(null),u=(0,a.useRef)(null),[m,g]=(0,a.useState)([]),[x,h]=(0,a.useState)(null),[p,b]=(0,a.useState)(!1),[f,y]=(0,a.useState)(1),[v,j]=(0,a.useState)({x:0,y:0}),[w,N]=(0,a.useState)(!1),[S,L]=(0,a.useState)({x:0,y:0}),I=a.default.useCallback(()=>{let e=d.current,t=c.current;if(!e||!t||!p)return;let a=e.getContext("2d");a&&(a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.clearRect(0,0,e.width,e.height),a.save(),a.translate(v.x,v.y),a.scale(f,f),a.drawImage(t,0,0),r.forEach(e=>{((e,t,a,r)=>{if(t.area.points.length<3)return;e.beginPath(),e.moveTo(t.area.points[0].x,t.area.points[0].y),t.area.points.forEach(t=>{e.lineTo(t.x,t.y)}),e.closePath();let l="rgba(34, 197, 94, 0.3)",o="#22c55e";t.status===s.LotStatus.RESERVED?(l="rgba(251, 191, 36, 0.3)",o="#fbbf24"):t.status===s.LotStatus.SOLD&&(l="rgba(239, 68, 68, 0.3)",o="#ef4444"),a&&(l=l.replace("0.3","0.5"),o="#000"),r&&(l="rgba(59, 130, 246, 0.5)",o="#3b82f6"),e.fillStyle=l,e.fill(),e.strokeStyle=o,e.lineWidth=a||r?3:2,e.stroke()})(a,e,e.id===x?.id,e.id===n)}),o&&m.length>0&&(a.beginPath(),a.moveTo(m[0].x,m[0].y),m.forEach(e=>{a.lineTo(e.x,e.y)}),a.strokeStyle="#3b82f6",a.lineWidth=2/f,a.stroke(),m.forEach(e=>{a.beginPath(),a.arc(e.x,e.y,5/f,0,2*Math.PI),a.fillStyle="#3b82f6",a.fill()})),a.restore())},[p,r,m,x,n,o,f,v]);(0,a.useEffect)(()=>{let t=d.current,a=c.current;t&&a&&t.getContext("2d")&&(a.onload=()=>{t.width=a.naturalWidth,t.height=a.naturalHeight,b(!0)},a.src=e)},[e]),(0,a.useEffect)(()=>{I()},[I]);let E=(e,t,a)=>{let s=!1;for(let r=0,l=a.length-1;r<a.length;l=r++){let o=a[r].x,i=a[r].y,n=a[l].x,d=a[l].y;i>t!=d>t&&e<(n-o)*(t-i)/(d-i)+o&&(s=!s)}return s},A=e=>{let t=d.current;if(!t)return{x:0,y:0};let a=t.getBoundingClientRect(),s=e.clientX-a.left,r=e.clientY-a.top,l=t.width/a.width,o=t.height/a.height;return{x:(s*l-v.x)/f,y:(r*o-v.y)/f}},D=()=>{N(!1),d.current&&(d.current.style.cursor="default")};return(0,a.useEffect)(()=>{let e=d.current;if(!e)return;let t=t=>{t.preventDefault();let a=e.getBoundingClientRect(),s=t.clientX-a.left,r=t.clientY-a.top;if(s<0||s>a.width||r<0||r>a.height)return;let l=e.width/a.width,o=e.height/a.height,i=s*l,n=r*o,d=t.deltaY>0?-.1:.1;y(e=>{let t=Math.min(Math.max(.5,e+d),5),a=t/e;return j(e=>({x:i-(i-e.x)*a,y:n-(n-e.y)*a})),t})};return e.addEventListener("wheel",t,{passive:!1}),()=>{e.removeEventListener("wheel",t)}},[]),(0,t.jsxs)("div",{ref:u,className:"relative",children:[(0,t.jsx)("img",{ref:c,src:e,alt:"Map",className:"hidden"}),(0,t.jsx)("canvas",{ref:d,onClick:e=>{if(w)return;let{x:t,y:a}=A(e);if(o)g([...m,{x:t,y:a}]);else{let e=r.find(e=>E(t,a,e.area.points));e&&l&&l(e)}},onMouseMove:e=>{let t=d.current;if(!t)return;if(w){let a=t.getBoundingClientRect(),s=t.width/a.width,r=t.height/a.height,l=(e.clientX-S.x)*s,o=(e.clientY-S.y)*r;j(e=>({x:e.x+l,y:e.y+o})),L({x:e.clientX,y:e.clientY});return}if(o)return;let{x:a,y:s}=A(e),l=r.find(e=>E(a,s,e.area.points));h(l||null),l?t.style.cursor="pointer":t.style.cursor="default"},onMouseDown:e=>{2===e.button&&(e.preventDefault(),N(!0),L({x:e.clientX,y:e.clientY}),d.current&&(d.current.style.cursor="grabbing"))},onMouseUp:D,onMouseLeave:D,onContextMenu:e=>{e.preventDefault()},className:"max-w-full h-auto border border-gray-300 rounded-lg"}),(0,t.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:[(0,t.jsx)("button",{onClick:()=>y(e=>Math.min(e+.2,5)),className:"bg-white hover:bg-gray-50 text-gray-800 font-bold py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl",title:"Zoom In",children:"+"}),(0,t.jsx)("button",{onClick:()=>y(e=>Math.max(e-.2,.5)),className:"bg-white hover:bg-gray-50 text-gray-800 font-bold py-2 px-3 rounded-lg shadow-lg border border-gray-200 transition-all hover:shadow-xl",title:"Zoom Out",children:"âˆ’"}),(0,t.jsx)("button",{onClick:()=>{y(1),j({x:0,y:0})},className:"bg-white hover:bg-gray-50 text-gray-800 font-semibold py-2 px-3 rounded-lg shadow-lg border border-gray-200 text-xs transition-all hover:shadow-xl",title:"Reset Zoom",children:"100%"})]}),o&&m.length>0&&(0,t.jsxs)("div",{className:"absolute top-4 left-4 flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>{m.length>=3&&i&&(i({points:m}),g([]))},className:"px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 shadow-lg transition-all hover:shadow-xl disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none",disabled:m.length<3,children:["Finalizar Ãrea (",m.length," pontos)"]}),(0,t.jsx)("button",{onClick:()=>{g([])},className:"px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 shadow-lg transition-all hover:shadow-xl",children:"Cancelar"})]}),x&&!o&&(0,t.jsxs)("div",{className:"absolute top-4 left-4 bg-white p-4 rounded-lg shadow-xl border border-gray-200",children:[(0,t.jsxs)("h3",{className:"font-bold text-lg text-gray-900 mb-2",children:["Lote ",x.lotNumber]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Status:"})," ",(0,t.jsx)("span",{className:x.status===s.LotStatus.AVAILABLE?"font-semibold text-green-700":x.status===s.LotStatus.RESERVED?"font-semibold text-amber-700":"font-semibold text-red-700",children:x.status===s.LotStatus.AVAILABLE?"DisponÃ­vel":x.status===s.LotStatus.RESERVED?"Reservado":"Vendido"})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Ãrea:"})," ",x.size,"mÂ²"]}),(0,t.jsxs)("p",{className:"text-base font-bold text-gray-900 mt-2",children:["R$ ",x.price.toLocaleString("pt-BR")]})]})]})}e.s(["default",()=>r])},25863,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(73297),l=e.i(56563),o=e.i(31886);function i(){let e=(0,s.useSearchParams)(),i=(0,s.useRouter)(),n=e.get("mapId")||"",[d,c]=(0,a.useState)(null),[u,m]=(0,a.useState)([]),[g,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[b,f]=(0,a.useState)();(0,a.useEffect)(()=>{let e;n&&(e=(0,l.getMapById)(n))&&(c(e),m((0,l.getLotsByMapId)(n)))},[n]);let y=e=>{p(e),x(!0),f(e.id)};return d?(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("button",{onClick:()=>i.push("/admin/maps"),className:"text-blue-700 hover:text-blue-900 font-medium hover:underline mb-2 transition-colors",children:"â† Voltar para Mapas"}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:d.name}),d.description&&(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:d.description})]}),(0,t.jsx)("button",{onClick:()=>{p({id:Date.now().toString(),mapId:n,lotNumber:"",area:{points:[]},status:r.LotStatus.AVAILABLE,price:0,size:0,description:"",features:[],createdAt:new Date,updatedAt:new Date}),x(!0),f(void 0)},className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 shadow-md transition-all hover:shadow-lg",children:"Novo Lote"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(o.default,{imageUrl:d.imageUrl,lots:u,isEditMode:g,onAreaDrawn:e=>{h&&p({...h,area:e})},selectedLotId:b,onLotClick:e=>{g||y(e)}})}),(0,t.jsxs)("div",{className:"space-y-4",children:[g&&h&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:[h.area.points.length>0?"Editar":"Novo"," Lote"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"NÃºmero do Lote"}),(0,t.jsx)("input",{type:"text",value:h.lotNumber,onChange:e=>p({...h,lotNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: 01, A1, etc"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Ãrea (mÂ²)"}),(0,t.jsx)("input",{type:"number",value:h.size||"",onChange:e=>p({...h,size:""===e.target.value?0:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"300"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"PreÃ§o (R$)"}),(0,t.jsx)("input",{type:"number",value:h.price||"",onChange:e=>p({...h,price:""===e.target.value?0:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"50000"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:h.status,onChange:e=>p({...h,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:r.LotStatus.AVAILABLE,children:"DisponÃ­vel"}),(0,t.jsx)("option",{value:r.LotStatus.RESERVED,children:"Reservado"}),(0,t.jsx)("option",{value:r.LotStatus.SOLD,children:"Vendido"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"DescriÃ§Ã£o"}),(0,t.jsx)("textarea",{value:h.description,onChange:e=>p({...h,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"DescriÃ§Ã£o do lote"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"CaracterÃ­sticas (separadas por vÃ­rgula)"}),(0,t.jsx)("input",{type:"text",value:h.features?.join(", ")||"",onChange:e=>p({...h,features:e.target.value.split(",").map(e=>e.trim())}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ãgua, Luz, Portaria"})]}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,t.jsx)("p",{className:"text-sm text-blue-800 font-medium",children:0===h.area.points.length?"ðŸ‘† Clique no mapa para desenhar a Ã¡rea do lote":`âœ“ ${h.area.points.length} pontos desenhados`})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{if(!h||!h.lotNumber||h.area.points.length<3)return void alert("Preencha todos os campos e desenhe a Ã¡rea do lote");let e={...h,mapId:n,updatedAt:new Date};(0,l.saveLot)(e),m((0,l.getLotsByMapId)(n)),x(!1),p(null),f(void 0)},className:"flex-1 px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 shadow-sm transition-all hover:shadow-md disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none",disabled:h.area.points.length<3,children:"Salvar"}),(0,t.jsx)("button",{onClick:()=>{x(!1),p(null),f(void 0)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 shadow-sm transition-colors",children:"Cancelar"})]})]})]}),!g&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Lotes Cadastrados"}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[u.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-bold text-gray-900",children:["Lote ",e.lotNumber]}),(0,t.jsx)("p",{className:"text-sm font-medium",children:(0,t.jsx)("span",{className:e.status===r.LotStatus.AVAILABLE?"text-green-700":e.status===r.LotStatus.RESERVED?"text-amber-700":"text-red-700",children:e.status===r.LotStatus.AVAILABLE?"DisponÃ­vel":e.status===r.LotStatus.RESERVED?"Reservado":"Vendido"})})]}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:["R$ ",e.price.toLocaleString("pt-BR")]})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Ãrea:"})," ",e.size,"mÂ²"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>y(e),className:"flex-1 px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 transition-colors shadow-sm hover:shadow-md",children:"Editar"}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void(confirm("Tem certeza que deseja excluir este lote?")&&((0,l.deleteLot)(t),m((0,l.getLotsByMapId)(n))))},className:"px-3 py-1 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 transition-colors shadow-sm hover:shadow-md",children:"Excluir"})]})]},e.id)),0===u.length&&(0,t.jsx)("p",{className:"text-gray-600 text-sm text-center py-4",children:"Nenhum lote cadastrado"})]})]})]})]})]}):(0,t.jsx)("div",{className:"p-6",children:"Carregando..."})}function n(){return(0,t.jsx)(i,{})}function d(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"p-6 text-center",children:"Carregando..."}),children:(0,t.jsx)(n,{})})}e.s(["default",()=>d],25863)}]);